SELECT 
    sub.ID,
    sub.obg_no, 
    sub.obl_no,
    sub.ACT_ESCROW_STATUS, 
    sub.ESCROW_AMT_DUE, 
    sub.alt_loan_num,
    sub.earliest_date,
    sub.proc_tp,
    sub.amount
FROM (
    SELECT 
        ROWNUM as ID,
        edr.obg_no, 
        edr.obl_no,
        eai.ACT_ESCROW_STATUS, 
        mep.ESCROW_AMT_DUE, 
        obln.alt_loan_num,
        obln.proc_tp,
        LEAST(
            COALESCE(edr.dis_dt_1, TO_DATE('9999-12-31', 'YYYY-MM-DD')),
            COALESCE(edr.dis_dt_2, TO_DATE('9999-12-31', 'YYYY-MM-DD')),
            COALESCE(edr.dis_dt_3, TO_DATE('9999-12-31', 'YYYY-MM-DD'))
            -- Add more lines here for additional date fields
        ) AS earliest_date,
        CASE 
            WHEN edr.dis_dt_1 = earliest_date THEN edr.disb_amount_1
            WHEN edr.dis_dt_2 = earliest_date THEN edr.disb_amount_2
            WHEN edr.dis_dt_3 = earliest_date THEN edr.disb_amount_3
            -- Add more lines here for additional amount fields
            ELSE 0
        END AS amount
    FROM 
        esc_disb_rec edr
    LEFT JOIN ESC_ACCT_INDI2 eai ON edr.obg_no = eai.obg_no AND edr.esc_acct_no = eai.ESCROW_ACCT_NO AND edr.obl_no = eai.obl_no
    LEFT JOIN mult_escrow_pntr mep ON mep.ob1_no = edr.obl_no AND mep.ob_no = edr.obg_no AND mep.ESCROW_ACCT_NO = eai.ESCROW_ACCT_NO
    LEFT JOIN obn obln ON mep.obg_no = obln.obg_no AND mep.obl_no = obln.obl_no
) sub
WHERE 
    sub.proc_tp >= 5000 
    AND ((sub.disb_type >= 10000 AND sub.disb_type <= 19999) OR sub.disb_type = 40002)
ORDER BY 
    sub.ID;
