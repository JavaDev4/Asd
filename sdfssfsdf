SELECT 
    ROWNUM as ID,
    edr.obg_no, 
    edr.obl_no,
    eai.ACT_ESCROW_STATUS, 
    mep.ESCROW_AMT_DUE, 
    obln.alt_loan_num,
    edr.disb_type,
    obln.proc_tp,
    edr.TAX_POLICY_NO,
    sub.earliest_future_date,
    CASE 
        WHEN sub.earliest_future_date = edr.dis_dt_1 THEN edr.disb_amount_1
        WHEN sub.earliest_future_date = edr.dis_dt_2 THEN edr.disb_amount_2
        -- Add more conditions for dis_dt_3 to dis_dt_12
        ELSE 0
    END AS corresponding_amount
FROM 
    esc_disb_rec edr
LEFT JOIN ESC_ACCT_INDI2 eai 
    ON edr.obg_no = eai.obg_no 
    AND edr.esc_acct_no = eai.ESCROW_ACCT_NO 
    AND edr.obl_no = eai.obl_no
LEFT JOIN mult_escrow_pntr mep 
    ON mep.obl_no = edr.obl_no 
    AND mep.obg_no = edr.obg_no 
LEFT JOIN obn obln 
    ON mep.obg_no = obln.obg_no 
    AND mep.obl_no = obln.obl_no,
    (SELECT edr_inner.obg_no, edr_inner.obl_no,
    LEAST(
        CASE WHEN edr_inner.dis_dt_1 > SYSDATE THEN edr_inner.dis_dt_1 ELSE DATE '9999-12-31' END,
        CASE WHEN edr_inner.dis_dt_2 > SYSDATE THEN edr_inner.dis_dt_2 ELSE DATE '9999-12-31' END
        -- Add more conditions for dis_dt_3 to dis_dt_12
    ) AS earliest_future_date
    FROM esc_disb_rec edr_inner
) sub
WHERE 
    edr.obg_no = sub.obg_no AND edr.obl_no = sub.obl_no
    AND obln.proc_tp >= :PROC_TP 
    AND ((edr.disb_type >= 10000 AND edr.disb_type <= 19999) OR edr.disb_type = 40002) 
    AND sub.earliest_future_date > SYSDATE
ORDER BY 
    ID;
